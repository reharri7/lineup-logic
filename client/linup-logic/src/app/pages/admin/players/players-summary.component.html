<div class="container mx-auto p-4">
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-2xl font-bold">Players Management</h1>
    <div class="flex gap-2">
      <button class="btn btn-success tooltip" [attr.data-tip]="modifierKeyText + '+E to create new player'" routerLink="new" (click)="createNewPlayer()">Create New Player</button>
      <button class="btn btn-outline tooltip" data-tip="Press Esc to go back" routerLink="/admin" (click)="goBack()">Back</button>
    </div>
  </div>

  <!-- Loading indicator -->
  @if (isLoading()) {
    <div class="flex justify-center my-4">
      <span class="loading loading-spinner loading-lg"></span>
    </div>
  }

  <!-- Filters -->
  <div class="card bg-base-200 mb-4">
    <div class="card-body">
      <h2 class="card-title">Filters</h2>
      <div class="flex flex-wrap gap-4 mb-2">
        <div class="form-control">
          <label class="label">Name</label>
          <input
            type="text"
            class="input input-bordered"
            [value]="nameFilter()"
            (input)="onNameFilterChange($event)"
            placeholder="Filter by name">
        </div>

        <div class="form-control">
          <label class="label">Number</label>
          <input
            type="number"
            class="input input-bordered"
            [value]="numberFilter()"
            (input)="onNumberFilterChange($event)"
            placeholder="Filter by number">
        </div>

        <div class="form-control">
          <label class="label">Team</label>
          <app-select
            [formControl]="teamCtrl"
            [options]="teams()"
            [labelKey]="'name'"
            [valueKey]="'id'"
            placeholder="All Teams"
            [includeBlankOption]="true"
          ></app-select>
        </div>

        <div class="form-control">
          <label class="label">Position</label>
          <app-select
            [formControl]="positionCtrl"
            [options]="positions()"
            [labelKey]="'position_name'"
            [valueKey]="'id'"
            placeholder="All Positions"
            [includeBlankOption]="true"
          ></app-select>
        </div>
      </div>

      <div class="flex gap-2">
        <button class="btn btn-primary" (click)="applyFilters()">Apply Filters</button>
        <button class="btn btn-outline" (click)="clearFilters()">Clear Filters</button>
      </div>
    </div>
  </div>

  <!-- Players list -->
  <div class="card bg-base-200">
    <div class="card-body">
      <h2 class="card-title">Players</h2>

      @if (players().length === 0 && !isLoading()) {
        <div class="alert alert-info">
          <span>No players found. Add a new player to get started.</span>
        </div>
      } @else {
        <div class="overflow-x-auto">
          <table class="table table-zebra w-full">
            <thead>
              <tr>
                <th (click)="sortTable('name')" class="cursor-pointer">
                  Name
                  @if(sortBy() == 'name' ) {
                    <span>
                      {{ sortDirection() === 'asc' ? '↑' : '↓' }}
                    </span>
                  }
                </th>
                <th (click)="sortTable('number')" class="cursor-pointer">
                  Number
                  @if(sortBy() === 'number' ) {
                    <span>
                      {{ sortDirection() === 'asc' ? '↑' : '↓' }}
                    </span>
                  }
                </th>
                <th (click)="sortTable('team_id')" class="cursor-pointer">
                  Team
                  @if(sortBy() === 'team_id' ) {
                    <span>
                      {{ sortDirection() === 'asc' ? '↑' : '↓' }}
                    </span>
                  }
                </th>
                <th (click)="sortTable('position_id')" class="cursor-pointer">
                  Position
                  @if(sortBy() === 'position_id') {
                    <span>
                      {{ sortDirection() === 'asc' ? '↑' : '↓' }}
                    </span>
                  }
                </th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (player of players(); track player.id) {
                <tr>
                  <td>{{ player.name }}</td>
                  <td>{{ player.number }}</td>
                  <td>{{ player.team?.name }}</td>
                  <td>{{ player.position?.position_name }}</td>
                  <td>
                    <div class="flex gap-2">
                      <button class="btn btn-sm btn-primary" [routerLink]="['/admin/players', player.id]">
                        Edit
                      </button>
                    </div>
                  </td>
                </tr>
              }
            </tbody>
          </table>
          <div class="join flex justify-center mt-4">
            <button
              class="join-item btn"
              [disabled]="currentPage() === 1"
              (click)="goToFirstPage()">
              First
            </button>

            <button
              class="join-item btn"
              [disabled]="currentPage() === 1"
              (click)="prevPage()">
              «
            </button>

            <button
              class="join-item btn btn-active"
              disabled>
              {{ currentPage() }}
            </button>

            <button
              class="join-item btn"
              [disabled]="currentPage() === totalPages()"
              (click)="nextPage()">
              »
            </button>

            <button
              class="join-item btn"
              [disabled]="currentPage() === totalPages()"
              (click)="goToLastPage()">
              Last
            </button>
          </div>

          <div class="text-center text-sm mt-2">
            Showing {{ (currentPage() - 1) * pageSize() + 1 }} to {{ upperBoundOfDisplayedEntries() }} of {{ totalCount() }} entries
          </div>
        </div>

      }
    </div>
  </div>
</div>
